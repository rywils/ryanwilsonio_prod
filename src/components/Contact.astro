---
// Contact.astro
export const prerender = false;
import { Mail, MapPin, Phone, Send } from '@lucide/astro';

const contactInfo = [
  {
    icon: Mail,
    label: 'Email',
    value: 'hello@ryanwilson.io',
    href: 'mailto:hello@ryanwilson.io',
  },
];
---

<section id="contact" class="py-20 px-4 sm:px-6 lg:px-8 relative overflow-hidden border-b-1 border-[#10191d] shadow-md shadow-[#0a0a0a]">
  <!-- Background decoration -->
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-primary-blue/5 to-transparent pointer-events-none"></div>
  
  <div class="max-w-6xl mx-auto relative z-10 contact-container">
    <div class="text-center mb-16">
      <h2 id="contact-heading" class="text-4xl sm:text-5xl md:text-6xl mb-4 contact-title text-(--primary-green) contact-info">
        Get In Touch
      </h2>
                  <div id="contact-underline" class="h-1 w-20 bg-gradient-to-r from-[var(--primary-blue)] to-[var(--primary-green)] mx-auto rounded-full mt-4 contact-info"></div>

   
      <p id="contact-subtitle"class="text-muted-foreground max-w-2xl mx-auto contact-subtitle contact-info pt-4">
        Have a project in mind or want to collaborate? Feel free to reach out!
      </p>
    </div>

    <div id="contact-grid" class="grid lg:grid-cols-5 gap-12">
      <!-- Contact Info -->
      <div id="contact-info" class="lg:col-span-2 space-y-6 ">
        <div id="contact-secondary-heading-block contact-info">
          <h3 class="text-2xl mb-4 font-semibold text-(--primary-blue) contact-secondary-heading contact-info">Let's Connect</h3>
          <p id="contact-info-first" class="text-muted-foreground mb-6 contact-info contact-info">
             I'm always interested in hearing about new projects and opportunities.
            Whether you have a question or just want to say hi, I'll try my best to
            get back to you!
          </p>
        </div>

        <div id="contact-email" class="space-y-12 contact-info">
          {contactInfo.map((info, index) => {
            const Icon = info.icon;
            return (
              <p id="contact-email-subtitle" class="text-muted-foreground text-md contact-info">If you'd rather contact me via email instead of through the contact form, feel free to do so!</p>
               <a href={info.href}
                class="contact-info-card flex items-center gap-4 p-4 rounded-xl bg-gradient-to-br from-(--primary-blue)/10 to-(--secondary-purple)/10 border border-(--primary-blue)/20 hover:border-primary-blue/50 transition-all hover:translate-x-1 hover:glow-(--primary-blue)  group"
                style={`--info-delay: ${0.7 + index * 0.1}s`}
              >
                <div class="p-3 rounded-full bg-(--primary-blue)/10 border border-(--primary-blue)/30 group-hover:bg-(--primary-blue)/20 transition-colors ">
                  <Icon class="w-5 h-5 text-primary-blue" />
                </div>
                <p></p>
                <div>
                  <p class="text-sm text-muted-foreground contact-info">{info.label}</p>
                  <p class="group-hover:text-(--primary-blue) transition-colors contact-info">
                    {info.value}
                  </p>
                </div>
              </a>
            );
          })}
        </div>

        <div id="contact-info-third" class=" contact-info contact-response-card p-6 rounded-xl bg-gradient-to-br from-(--primary-blue)/10 to-(--secondary-purple)/10 border border-(--primary-blue)/30">
          <h4 class="mb-2 font-semibold text-(--primary-blue)">Quick Response</h4>
          <p class="text-sm text-muted-foreground">
            I typically respond within 24 hours on business days
          </p>
        </div>
      </div>

      <!-- Contact Form -->
      <div class="lg:col-span-3 contact-form">
        <form id="contact-form" class="space-y-6">
          <div class="grid sm:grid-cols-2 gap-6">
            <div class="contact-field">
              <label for="name" class="block mb-2">
                Name
              </label>
              <input
                id="name"
                name="name"
                type="text"
                placeholder="Your name"
                required
                class="w-full px-4 py-3 rounded-lg bg-background border border-(--primary-blue)/20 focus:border-(--primary-blue) focus:outline-none focus:ring-2 focus:ring-(--primary-blue)/20 transition-colors"
              />
            </div>

            <div class="contact-field" style="--field-delay: 0.1s">
              <label for="email" class="block mb-2">
                Email
              </label>
              <input
                id="email"
                name="email"
                type="email"
                placeholder="your.email@example.com"
                required
                class="w-full px-4 py-3 rounded-lg bg-background border border-(--primary-blue)/20 focus:border-primary-blue focus:outline-none focus:ring-2 focus:ring-primary-blue/20 transition-colors"
              />
            </div>
          </div>

          <div class="contact-field" style="--field-delay: 0.2s">
            <label for="reason" class="block mb-2">
              Reason for Contact
            </label>
            <select
              id="reason"
              name="reason"
              required
              class="w-full px-4 py-3 rounded-lg bg-background border border-(--primary-blue)/20 focus:border-primary-blue focus:outline-none focus:ring-2 focus:ring-primary-blue/20 transition-colors"
            >
              <option value="inquiry">Inquiry</option>
              <option value="employer">Employer</option>
              <option value="collaboration">Collaboration</option>
            </select>
          </div>

          <div class="contact-field" style="--field-delay: 0.3s">
            <label for="message" class="block mb-2">
              Message
            </label>
            <textarea
              id="message"
              name="message"
              placeholder="Tell me about your project or opportunity..."
              required
              rows="6"
              class="w-full px-4 py-3 rounded-lg bg-background border border-(--primary-blue)/20 focus:border-(--primary-blue) focus:outline-none focus:ring-2 focus:ring-primary-blue/20 transition-colors resize-none"
            ></textarea>
          </div>

          <div id="contact-submit"class="contact-submit">
            <button
              type="submit"
              id="submit-button"
              class="w-full sm:w-auto px-8 py-3 bg-(-primary-blu) rounded-lg glow-primary-blue flex items-center justify-center gap-2 hover:bg-secondary-purple hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:curso                  r-not-allowe text-(--primary-blue)"
            >
              <Send size={20} />
              <span id="button-text" class="text-(--primary-blue)">Send Message</span>
            </button>
          </div>

          <!-- Toast notification container -->
          <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
import type { CollectionEntry } from "astro:content";


 



  if (typeof window !== 'undefined') {
    const observerOptions = {
      threshold: 0.3,
      rootMargin: '0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    function setupObserver() {
      const section = document.querySelector('#contact .contact-container');
      if (section) {
        observer.observe(section);
      }
    }

    // Toast notification function
    function showToast(message: string, type: 'success' | 'error') {
      const container = document.getElementById('toast-container');
      if (!container) return;

      const toast = document.createElement('div');
      toast.className = `px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 ${
        type === 'success' 
          ? 'bg-green-500 text-white' 
          : 'bg-red-500 text-white'
      }`;
      toast.textContent = message;
      
      container.appendChild(toast);

      // Animate in
      setTimeout(() => toast.classList.add('translate-y-0', 'opacity-100'), 10);

      // Remove after 5 seconds
      setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => container.removeChild(toast), 300);
      }, 5000);
    }

    function setupForm() {
      const form = document.getElementById('contact-form') as HTMLFormElement;
      const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
      const buttonText = document.getElementById('button-text') as HTMLSpanElement;

      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          // Disable button and show loading state
          submitButton.disabled = true;
          buttonText.textContent = 'Sending...';

          const formData = new FormData(form);
          const data = {
            name: formData.get('name') as string,
            email: formData.get('email') as string,
            reason: formData.get('reason') as string,
            message: formData.get('message') as string,
          };

          try {
            // Send to your API endpoint
            const response = await fetch('/api/contact', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              showToast("Message sent! I'll get back to you soon.", 'success');
              form.reset();
            } else {
              const errorData = await response.json();
              showToast(`Failed to send message: ${errorData.message || 'Server error.'}`, 'error');
            }
          } catch (error) {
            console.error('Submission Error:', error);
            showToast('Network error. Please check your connection and try again.', 'error');
          } finally {
            // Re-enable button
            submitButton.disabled = false;
            buttonText.textContent = 'Send Message';
          }
        });
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupObserver();
      setupForm();
    });

    document.addEventListener('astro:page-load', () => {
      setupObserver();
      setupForm();
    });
  }
</script>
