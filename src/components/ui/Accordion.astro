---
interface Props {
  items: Array<{
    title: string;
    content: string;
  }>;
  allowMultiple?: boolean;
  className?: string;
}

const { items, allowMultiple = false, className = "" } = Astro.props;
const accordionId = `accordion-${Math.random().toString(36).substr(2, 9)}`;
---

<div class={`accordion ${className}`} data-accordion-id={accordionId}>
  {items.map((item, index) => (
    <details class="accordion-item" data-index={index}>
      <summary class="accordion-trigger">
        <span class="accordion-title">{item.title}</span>
        <svg
          class="accordion-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </summary>
      <div class="accordion-content">
        <p>{item.content}</p>
      </div>
    </details>
  ))}
</div>

{!allowMultiple && (
  <script define:vars={{ accordionId }}>
    // Only allow one item open at a time
    const accordion = document.querySelector(`[data-accordion-id="${accordionId}"]`);
    if (accordion) {
      accordion.addEventListener('toggle', (e) => {
        if (e.target.open) {
          const openDetails = accordion.querySelectorAll('details[open]');
          openDetails.forEach(details => {
            if (details !== e.target) {
              details.removeAttribute('open');
            }
          });
        }
      }, true);
    }
  </script>
)}

<style>
  .accordion {
    width: 100%;
  }

  .accordion-item {
    border-bottom: 1px solid hsl(var(--border));
  }

  .accordion-item:last-child {
    border-bottom: none;
  }

  .accordion-trigger {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    padding: 1rem 0;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    text-align: left;
    transition: all 0.2s;
    list-style: none;
    outline: none;
  }

  .accordion-trigger::-webkit-details-marker {
    display: none;
  }

  .accordion-trigger:hover {
    text-decoration: underline;
  }

  .accordion-trigger:focus-visible {
    outline: 3px solid hsl(var(--ring) / 0.5);
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  .accordion-title {
    flex: 1;
  }

  .accordion-icon {
    flex-shrink: 0;
    width: 1rem;
    height: 1rem;
    color: hsl(var(--muted-foreground));
    transition: transform 0.2s;
    transform: translateY(0.125rem);
  }

  details[open] .accordion-icon {
    transform: translateY(0.125rem) rotate(180deg);
  }

  .accordion-content {
    padding: 0 0 1rem 0;
    font-size: 0.875rem;
    animation: slideDown 0.2s ease-out;
  }

  .accordion-content p {
    margin: 0;
    color: hsl(var(--muted-foreground));
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-0.5rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Closing animation */
  details:not([open]) .accordion-content {
    animation: slideUp 0.2s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-0.5rem);
    }
  }
</style>